{"code":"import { __assign, __extends } from \"tslib\";\r\nimport { each } from 'lodash';\r\nimport { getBorderPositionAndStyle } from \"../../utils/cell/cell\";\r\nimport { translateGroup } from '../utils';\r\nimport { BaseHeader } from './base';\r\nimport { Node } from \"../layout/node\";\r\nimport { renderRect, renderLine } from \"../../utils/g-renders\";\r\nimport { measureTextWidth } from \"../../utils/text\";\r\nimport { getAdjustPosition } from \"../../utils/text-absorption\";\r\nimport { CellBorderPosition } from \"../../common/interface\";\r\nvar SeriesNumberHeader = /** @class */ (function (_super) {\r\n    __extends(SeriesNumberHeader, _super);\r\n    function SeriesNumberHeader(cfg) {\r\n        return _super.call(this, cfg) || this;\r\n    }\r\n    /**\r\n     * Get seriesNumber header by config\r\n     * @param viewportBBox\r\n     * @param seriesNumberWidth\r\n     * @param leafNodes\r\n     * @param spreadsheet\r\n     * @param cornerWidth\r\n     */\r\n    SeriesNumberHeader.getSeriesNumberHeader = function (viewportBBox, seriesNumberWidth, leafNodes, spreadsheet, cornerWidth) {\r\n        var height = viewportBBox.height, viewportHeight = viewportBBox.viewportHeight;\r\n        var seriesNodes = [];\r\n        var isHierarchyTreeType = spreadsheet.isHierarchyTreeType();\r\n        leafNodes.forEach(function (node) {\r\n            // 1、is spreadsheet and node is not total(grand or sub)\r\n            // 2、is listSheet\r\n            if (!node.isTotals || isHierarchyTreeType) {\r\n                var sNode = new Node({\r\n                    id: '',\r\n                    key: '',\r\n                    value: \"\".concat(seriesNodes.length + 1),\r\n                });\r\n                sNode.x = node.x;\r\n                sNode.y = node.y;\r\n                sNode.height = node.height;\r\n                sNode.width = seriesNumberWidth;\r\n                seriesNodes.push(sNode);\r\n            }\r\n        });\r\n        return new SeriesNumberHeader({\r\n            width: cornerWidth,\r\n            height: height,\r\n            viewportWidth: cornerWidth,\r\n            viewportHeight: viewportHeight,\r\n            position: { x: 0, y: viewportBBox.y },\r\n            data: seriesNodes,\r\n            spreadsheet: spreadsheet,\r\n        });\r\n    };\r\n    SeriesNumberHeader.prototype.clip = function () {\r\n        var _a = this.headerConfig, width = _a.width, viewportHeight = _a.viewportHeight, scrollY = _a.scrollY;\r\n        this.setClip({\r\n            type: 'rect',\r\n            attrs: {\r\n                x: 0,\r\n                y: scrollY,\r\n                width: width,\r\n                height: viewportHeight,\r\n            },\r\n        });\r\n    };\r\n    SeriesNumberHeader.prototype.layout = function () {\r\n        var _this = this;\r\n        var _a = this.headerConfig, data = _a.data, scrollY = _a.scrollY, viewportHeight = _a.viewportHeight, spreadsheet = _a.spreadsheet;\r\n        if (spreadsheet.isPivotMode) {\r\n            //  添加矩形背景\r\n            this.addBackGround();\r\n        }\r\n        var borderGroup = this.addGroup();\r\n        each(data, function (item) {\r\n            var y = item.y, cellHeight = item.height, isLeaf = item.isLeaf;\r\n            var isHeaderCellInViewport = _this.isHeaderCellInViewport(y, cellHeight, scrollY, viewportHeight);\r\n            if (isHeaderCellInViewport) {\r\n                // 按需渲染：视窗内的才渲染\r\n                var group = _this.addGroup();\r\n                // 添加文本\r\n                _this.addText(group, item);\r\n                _this.add(group);\r\n                // 添加边框\r\n                if (!isLeaf) {\r\n                    _this.addBorder(borderGroup, item);\r\n                }\r\n            }\r\n        });\r\n    };\r\n    SeriesNumberHeader.prototype.offset = function () {\r\n        var _a = this.headerConfig, scrollY = _a.scrollY, scrollX = _a.scrollX, position = _a.position;\r\n        translateGroup(this, position.x - scrollX, position.y - scrollY);\r\n        if (this.backgroundShape) {\r\n            this.backgroundShape.translate(position.x, position.y + scrollY);\r\n        }\r\n        if (this.leftBorderShape) {\r\n            this.leftBorderShape.translate(position.x, position.y + scrollY);\r\n        }\r\n    };\r\n    SeriesNumberHeader.prototype.addBackGround = function () {\r\n        var rowCellTheme = this.headerConfig.spreadsheet.theme.rowCell.cell;\r\n        var _a = this.headerConfig, position = _a.position, width = _a.width, viewportHeight = _a.viewportHeight;\r\n        this.backgroundShape = renderRect(this, {\r\n            x: position.x,\r\n            y: -position.y,\r\n            width: width,\r\n            height: viewportHeight,\r\n            fill: rowCellTheme.backgroundColor,\r\n            stroke: 'transparent',\r\n            opacity: rowCellTheme.backgroundColorOpacity,\r\n        });\r\n        var _b = getBorderPositionAndStyle(CellBorderPosition.LEFT, {\r\n            x: position.x,\r\n            y: -position.y,\r\n            width: width,\r\n            height: viewportHeight,\r\n        }, rowCellTheme), borderPosition = _b.position, borderStyle = _b.style;\r\n        this.leftBorderShape = renderLine(this, borderPosition, borderStyle);\r\n    };\r\n    SeriesNumberHeader.prototype.addBorder = function (group, cellData) {\r\n        var cellTheme = this.headerConfig.spreadsheet.theme.rowCell.cell;\r\n        var _a = getBorderPositionAndStyle(CellBorderPosition.BOTTOM, cellData, cellTheme), horizontalPosition = _a.position, horizontalStyle = _a.style;\r\n        renderLine(group, horizontalPosition, horizontalStyle);\r\n    };\r\n    SeriesNumberHeader.prototype.addText = function (group, cellData) {\r\n        var _a = this.headerConfig, scrollY = _a.scrollY, height = _a.viewportHeight;\r\n        var rowCellTheme = this.headerConfig.spreadsheet.theme.rowCell;\r\n        var label = cellData.label, x = cellData.x, y = cellData.y, cellWidth = cellData.width, cellHeight = cellData.height, isLeaf = cellData.isLeaf, isTotals = cellData.isTotals;\r\n        var padding = this.getTextPadding(label, cellWidth);\r\n        var textStyle = isLeaf && !isTotals ? rowCellTheme.text : rowCellTheme.bolderText;\r\n        var textY = getAdjustPosition(y + padding.top, cellHeight - padding.top - padding.bottom, scrollY, height, textStyle.fontSize);\r\n        group.addShape('text', {\r\n            attrs: __assign(__assign({ x: x + padding.left, y: textY + textStyle.fontSize / 2, text: label }, textStyle), { cursor: 'pointer' }),\r\n        });\r\n    };\r\n    SeriesNumberHeader.prototype.getTextPadding = function (text, cellWidth) {\r\n        var rowCellTheme = this.headerConfig.spreadsheet.theme.rowCell;\r\n        var textWidth = measureTextWidth(text, rowCellTheme.text);\r\n        var padding = Math.max(Math.abs((cellWidth - textWidth) / 2), 4);\r\n        return __assign(__assign({}, rowCellTheme.cell.padding), { left: padding, right: padding });\r\n    };\r\n    return SeriesNumberHeader;\r\n}(BaseHeader));\r\nexport { SeriesNumberHeader };\r\n//# sourceMappingURL=series-number.js.map","references":["F:/Ismart/S2-master/node_modules/@antv/g-canvas/lib/index.d.ts","F:/Ismart/S2-master/node_modules/@types/lodash/index.d.ts","F:/Ismart/S2-master/packages/s2-core/src/utils/cell/cell.ts","F:/Ismart/S2-master/packages/s2-core/src/facet/utils.ts","F:/Ismart/S2-master/packages/s2-core/src/facet/bbox/panelBBox.ts","F:/Ismart/S2-master/packages/s2-core/src/facet/header/base.ts","F:/Ismart/S2-master/packages/s2-core/src/facet/layout/node.ts","F:/Ismart/S2-master/packages/s2-core/src/sheet-type/index.ts","F:/Ismart/S2-master/packages/s2-core/src/utils/g-renders.ts","F:/Ismart/S2-master/packages/s2-core/src/utils/text.ts","F:/Ismart/S2-master/packages/s2-core/src/utils/text-absorption.ts","F:/Ismart/S2-master/packages/s2-core/src/common/interface/index.ts"],"map":"{\"version\":3,\"file\":\"series-number.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/facet/header/series-number.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"F:/Ismart/S2-master/packages/s2-core/node_modules/.cache/rollup-plugin-typescript2/placeholder/facet/header/series-number.d.ts","writeByteOrderMark":false,"text":"import { PanelBBox } from '../bbox/panelBBox';\r\nimport { BaseHeader, BaseHeaderConfig } from './base';\r\nimport { Node } from \"../layout/node\";\r\nimport { SpreadSheet } from \"../../sheet-type/index\";\r\nexport declare class SeriesNumberHeader extends BaseHeader<BaseHeaderConfig> {\r\n    private backgroundShape;\r\n    private leftBorderShape;\r\n    /**\r\n     * Get seriesNumber header by config\r\n     * @param viewportBBox\r\n     * @param seriesNumberWidth\r\n     * @param leafNodes\r\n     * @param spreadsheet\r\n     * @param cornerWidth\r\n     */\r\n    static getSeriesNumberHeader(viewportBBox: PanelBBox, seriesNumberWidth: number, leafNodes: Node[], spreadsheet: SpreadSheet, cornerWidth: number): SeriesNumberHeader;\r\n    constructor(cfg: BaseHeaderConfig);\r\n    clip(): void;\r\n    layout(): void;\r\n    protected offset(): void;\r\n    private addBackGround;\r\n    private addBorder;\r\n    private addText;\r\n    private getTextPadding;\r\n}\r\n"}}
