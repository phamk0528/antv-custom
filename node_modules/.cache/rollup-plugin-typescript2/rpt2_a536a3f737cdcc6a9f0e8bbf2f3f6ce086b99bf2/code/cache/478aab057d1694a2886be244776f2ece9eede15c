{"code":"var _a;\r\nimport { __read, __spreadArray } from \"tslib\";\r\nimport { get } from 'lodash';\r\nimport Decimal from 'decimal.js';\r\nimport { Aggregation } from '../common/interface';\r\nexport var isNotNumber = function (value) {\r\n    if (typeof value === 'number') {\r\n        return Number.isNaN(value);\r\n    }\r\n    if (typeof value === 'string') {\r\n        return Number.isNaN(Number.parseFloat(value));\r\n    }\r\n    return true;\r\n};\r\n/**\r\n * 预处理原始数据为 Decimal 对象数组\r\n * 所有不能转为 number 的数据默认为 0\r\n * @param data 原始数据数组\r\n * @param field 值字段\r\n * @param filterIllegalValue 是否过滤非法值？过滤后，包装后的数据数组短于原始数组长度\r\n * @returns 经过 Decimal 包装后的值数组\r\n */\r\nvar processFieldValues = function (data, field, filterIllegalValue) {\r\n    if (filterIllegalValue === void 0) { filterIllegalValue = false; }\r\n    if (!(data === null || data === void 0 ? void 0 : data.length)) {\r\n        return [];\r\n    }\r\n    return data.reduce(function (resultArr, item) {\r\n        var fieldValue = get(item, field);\r\n        var notNumber = isNotNumber(fieldValue);\r\n        if (filterIllegalValue && notNumber) {\r\n            // 过滤非法值\r\n            return resultArr;\r\n        }\r\n        var val = notNumber ? 0 : fieldValue;\r\n        resultArr.push(new Decimal(val));\r\n        return resultArr;\r\n    }, []);\r\n};\r\n/**\r\n * 计算数据项的和\r\n * @param data 数据项\r\n * @param field 值字段\r\n * @returns 算术和\r\n */\r\nexport var getDataSumByField = function (data, field) {\r\n    var fieldValues = processFieldValues(data, field);\r\n    if (!fieldValues.length) {\r\n        return 0;\r\n    }\r\n    return Decimal.sum.apply(Decimal, __spreadArray([], __read(fieldValues), false)).toNumber();\r\n};\r\n/**\r\n * 计算数据项的极值\r\n * @param method 最大值(max)或最小值(min)\r\n * @param data 数据项\r\n * @param field 值字段\r\n * @returns 最值\r\n */\r\nexport var getDataExtremumByField = function (method, data, field) {\r\n    // 防止预处理时默认值 0 影响极值结果，处理时需过滤非法值\r\n    var fieldValues = processFieldValues(data, field, true);\r\n    if (!(fieldValues === null || fieldValues === void 0 ? void 0 : fieldValues.length)) {\r\n        return;\r\n    }\r\n    return Decimal[method].apply(Decimal, __spreadArray([], __read(fieldValues), false)).toNumber();\r\n};\r\n/**\r\n * 计算数据项的平均值\r\n * @param data 数据项\r\n * @param field 值字段\r\n * @returns 算术平均值\r\n */\r\nexport var getDataAvgByField = function (data, field) {\r\n    var fieldValues = processFieldValues(data, field);\r\n    if (!(fieldValues === null || fieldValues === void 0 ? void 0 : fieldValues.length)) {\r\n        return 0;\r\n    }\r\n    return Decimal.sum.apply(Decimal, __spreadArray([], __read(fieldValues), false)).dividedBy(fieldValues.length)\r\n        .toNumber();\r\n};\r\n/**\r\n * totals 计算方法集合\r\n */\r\nexport var calcActionByType = (_a = {},\r\n    _a[Aggregation.SUM] = getDataSumByField,\r\n    _a[Aggregation.MIN] = function (data, field) {\r\n        return getDataExtremumByField('min', data, field);\r\n    },\r\n    _a[Aggregation.MAX] = function (data, field) {\r\n        return getDataExtremumByField('max', data, field);\r\n    },\r\n    _a[Aggregation.AVG] = getDataAvgByField,\r\n    _a);\r\n//# sourceMappingURL=number-calculate.js.map","references":["F:/Ismart/S2-master/node_modules/@types/lodash/index.d.ts","F:/Ismart/S2-master/node_modules/decimal.js/decimal.d.ts","F:/Ismart/S2-master/packages/s2-core/src/common/interface/index.ts"],"map":"{\"version\":3,\"file\":\"number-calculate.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/utils/number-calculate.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"F:/Ismart/S2-master/packages/s2-core/node_modules/.cache/rollup-plugin-typescript2/placeholder/utils/number-calculate.d.ts","writeByteOrderMark":false,"text":"import { Aggregation } from '../common/interface';\r\ndeclare type DataItem = Record<string, any>;\r\nexport declare const isNotNumber: (value: unknown) => boolean;\r\n/**\r\n * 计算数据项的和\r\n * @param data 数据项\r\n * @param field 值字段\r\n * @returns 算术和\r\n */\r\nexport declare const getDataSumByField: (data: DataItem[], field: string) => number;\r\n/**\r\n * 计算数据项的极值\r\n * @param method 最大值(max)或最小值(min)\r\n * @param data 数据项\r\n * @param field 值字段\r\n * @returns 最值\r\n */\r\nexport declare const getDataExtremumByField: (method: 'min' | 'max', data: DataItem[], field: string) => number;\r\n/**\r\n * 计算数据项的平均值\r\n * @param data 数据项\r\n * @param field 值字段\r\n * @returns 算术平均值\r\n */\r\nexport declare const getDataAvgByField: (data: DataItem[], field: string) => number;\r\n/**\r\n * totals 计算方法集合\r\n */\r\nexport declare const calcActionByType: {\r\n    [type in Aggregation]: (data: DataItem[], field: string) => number;\r\n};\r\nexport {};\r\n"}}
