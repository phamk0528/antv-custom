{"code":"import { __extends } from \"tslib\";\r\nimport { isFrozenCol, isFrozenTrailingCol } from \"../utils\";\r\nimport { getValidFrozenOptions } from \"../../utils/layout/frozen\";\r\nimport { ColHeader } from './col';\r\nimport { KEY_GROUP_FROZEN_COL_RESIZE_AREA, SERIES_NUMBER_FIELD, KEY_GROUP_COL_FROZEN, KEY_GROUP_COL_FROZEN_TRAILING, FRONT_GROUND_GROUP_COL_FROZEN_Z_INDEX, } from \"../../common/constant\";\r\nimport { TableColCell, TableCornerCell } from \"../../cell\";\r\n/**\r\n * Column Header for SpreadSheet\r\n */\r\nvar TableColHeader = /** @class */ (function (_super) {\r\n    __extends(TableColHeader, _super);\r\n    function TableColHeader(cfg) {\r\n        var _this = this;\r\n        var _a;\r\n        _this = _super.call(this, cfg) || this;\r\n        _this.getScrollGroupClipBBox = function () {\r\n            var _a;\r\n            var _b = _this.headerConfig, width = _b.width, height = _b.height, scrollX = _b.scrollX, spreadsheet = _b.spreadsheet;\r\n            var options = spreadsheet.options;\r\n            if (!options.frozenColCount && !options.frozenTrailingColCount) {\r\n                return {\r\n                    x: scrollX,\r\n                    y: 0,\r\n                    width: width,\r\n                    height: height,\r\n                };\r\n            }\r\n            var colLeafNodes = (_a = spreadsheet.facet) === null || _a === void 0 ? void 0 : _a.layoutResult.colLeafNodes;\r\n            var _c = getValidFrozenOptions(spreadsheet.options, colLeafNodes.length), frozenColCount = _c.frozenColCount, frozenTrailingColCount = _c.frozenTrailingColCount;\r\n            var frozenColWidth = 0;\r\n            var frozenTrailingColWidth = 0;\r\n            for (var i = 0; i < frozenColCount; i++) {\r\n                frozenColWidth += colLeafNodes[i].width;\r\n            }\r\n            for (var i = 0; i < frozenTrailingColCount; i++) {\r\n                frozenTrailingColWidth += colLeafNodes[colLeafNodes.length - 1 - i].width;\r\n            }\r\n            var frozenClipWidth = width - frozenColWidth - frozenTrailingColWidth;\r\n            return {\r\n                x: scrollX + frozenColWidth,\r\n                y: 0,\r\n                width: frozenClipWidth,\r\n                height: height,\r\n            };\r\n        };\r\n        var _b = (_a = _this.headerConfig.spreadsheet) === null || _a === void 0 ? void 0 : _a.options, frozenColCount = _b.frozenColCount, frozenTrailingColCount = _b.frozenTrailingColCount;\r\n        if (frozenColCount) {\r\n            _this.frozenColGroup = _this.addGroup({\r\n                name: KEY_GROUP_COL_FROZEN,\r\n                zIndex: FRONT_GROUND_GROUP_COL_FROZEN_Z_INDEX,\r\n            });\r\n        }\r\n        if (frozenTrailingColCount) {\r\n            _this.frozenTrailingColGroup = _this.addGroup({\r\n                name: KEY_GROUP_COL_FROZEN_TRAILING,\r\n                zIndex: FRONT_GROUND_GROUP_COL_FROZEN_Z_INDEX,\r\n            });\r\n        }\r\n        return _this;\r\n    }\r\n    TableColHeader.prototype.isFrozenCell = function (meta) {\r\n        var spreadsheet = this.headerConfig.spreadsheet;\r\n        var _a = spreadsheet === null || spreadsheet === void 0 ? void 0 : spreadsheet.options, frozenColCount = _a.frozenColCount, frozenTrailingColCount = _a.frozenTrailingColCount;\r\n        var colIndex = meta.colIndex;\r\n        var colLeafNodes = spreadsheet === null || spreadsheet === void 0 ? void 0 : spreadsheet.facet.layoutResult.colLeafNodes;\r\n        return (isFrozenCol(colIndex, frozenColCount) ||\r\n            isFrozenTrailingCol(colIndex, frozenTrailingColCount, colLeafNodes.length));\r\n    };\r\n    TableColHeader.prototype.clear = function () {\r\n        var _a, _b;\r\n        var spreadsheet = this.headerConfig.spreadsheet;\r\n        _super.prototype.clear.call(this);\r\n        (_a = this.frozenTrailingColGroup) === null || _a === void 0 ? void 0 : _a.clear();\r\n        (_b = this.frozenColGroup) === null || _b === void 0 ? void 0 : _b.clear();\r\n        // 额外清除冻结列的 Resizer Area\r\n        var resizerArea = spreadsheet === null || spreadsheet === void 0 ? void 0 : spreadsheet.foregroundGroup.findById(KEY_GROUP_FROZEN_COL_RESIZE_AREA);\r\n        resizerArea === null || resizerArea === void 0 ? void 0 : resizerArea.clear();\r\n    };\r\n    TableColHeader.prototype.getCellInstance = function (item, spreadsheet, headerConfig) {\r\n        return item.field === SERIES_NUMBER_FIELD\r\n            ? new TableCornerCell(item, spreadsheet, headerConfig)\r\n            : new TableColCell(item, spreadsheet, headerConfig);\r\n    };\r\n    TableColHeader.prototype.getCellGroup = function (node) {\r\n        var _a;\r\n        var spreadsheet = this.headerConfig.spreadsheet;\r\n        var _b = spreadsheet === null || spreadsheet === void 0 ? void 0 : spreadsheet.options, frozenColCount = _b.frozenColCount, frozenTrailingColCount = _b.frozenTrailingColCount;\r\n        var colLength = (_a = spreadsheet === null || spreadsheet === void 0 ? void 0 : spreadsheet.facet) === null || _a === void 0 ? void 0 : _a.layoutResult.colLeafNodes.length;\r\n        if (isFrozenCol(node.colIndex, frozenColCount)) {\r\n            return this.frozenColGroup;\r\n        }\r\n        if (isFrozenTrailingCol(node.colIndex, frozenTrailingColCount, colLength)) {\r\n            return this.frozenTrailingColGroup;\r\n        }\r\n        return this.scrollGroup;\r\n    };\r\n    TableColHeader.prototype.isColCellInRect = function (item) {\r\n        var _a;\r\n        var spreadsheet = this.headerConfig.spreadsheet;\r\n        var _b = spreadsheet === null || spreadsheet === void 0 ? void 0 : spreadsheet.options, frozenColCount = _b.frozenColCount, frozenTrailingColCount = _b.frozenTrailingColCount;\r\n        var colLength = (_a = spreadsheet === null || spreadsheet === void 0 ? void 0 : spreadsheet.facet) === null || _a === void 0 ? void 0 : _a.layoutResult.colLeafNodes.length;\r\n        if (isFrozenCol(item.colIndex, frozenColCount) ||\r\n            isFrozenTrailingCol(item.colIndex, frozenTrailingColCount, colLength)) {\r\n            return true;\r\n        }\r\n        return _super.prototype.isColCellInRect.call(this, item);\r\n    };\r\n    TableColHeader.prototype.clip = function () {\r\n        this.scrollGroup.setClip({\r\n            type: 'rect',\r\n            attrs: this.getScrollGroupClipBBox(),\r\n        });\r\n    };\r\n    return TableColHeader;\r\n}(ColHeader));\r\nexport { TableColHeader };\r\n//# sourceMappingURL=table-col.js.map","references":["F:/Ismart/S2-master/node_modules/@antv/g-canvas/lib/index.d.ts","F:/Ismart/S2-master/packages/s2-core/src/facet/utils.ts","F:/Ismart/S2-master/packages/s2-core/src/utils/layout/frozen.ts","F:/Ismart/S2-master/packages/s2-core/src/facet/header/col.ts","F:/Ismart/S2-master/packages/s2-core/src/common/constant/index.ts","F:/Ismart/S2-master/packages/s2-core/src/cell/index.ts","F:/Ismart/S2-master/packages/s2-core/src/facet/layout/node.ts","F:/Ismart/S2-master/packages/s2-core/src/sheet-type/index.ts"],"map":"{\"version\":3,\"file\":\"table-col.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/facet/header/table-col.ts\"],\"names\":[],\"mappings\":\"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\"}"}
