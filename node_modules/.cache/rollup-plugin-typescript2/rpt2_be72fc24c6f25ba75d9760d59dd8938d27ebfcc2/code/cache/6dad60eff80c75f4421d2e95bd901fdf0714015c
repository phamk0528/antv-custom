{"code":"import { debounce } from 'lodash';\r\nimport { MIN_DEVICE_PIXEL_RATIO } from \"../../common/constant/options\";\r\nimport { isMobile } from \"../../utils/is-mobile\";\r\nvar HdAdapter = /** @class */ (function () {\r\n    function HdAdapter(spreadsheet) {\r\n        var _this = this;\r\n        this.viewport = window;\r\n        this.init = function () {\r\n            _this.initDevicePixelRatioListener();\r\n            _this.initDeviceZoomListener();\r\n        };\r\n        this.destroy = function () {\r\n            _this.removeDevicePixelRatioListener();\r\n            _this.removeDeviceZoomListener();\r\n        };\r\n        this.removeDevicePixelRatioListener = function () {\r\n            var _a;\r\n            if ((_a = _this.devicePixelRatioMedia) === null || _a === void 0 ? void 0 : _a.removeEventListener) {\r\n                _this.devicePixelRatioMedia.removeEventListener('change', _this.renderByDevicePixelRatioChanged);\r\n            }\r\n            else {\r\n                _this.devicePixelRatioMedia.removeListener(_this.renderByDevicePixelRatioChanged);\r\n            }\r\n        };\r\n        this.initDeviceZoomListener = function () {\r\n            var _a, _b;\r\n            if (isMobile()) {\r\n                return;\r\n            }\r\n            // VisualViewport support browser zoom & mac touch tablet\r\n            (_b = (_a = _this.viewport) === null || _a === void 0 ? void 0 : _a.visualViewport) === null || _b === void 0 ? void 0 : _b.addEventListener('resize', _this.renderByZoomScale);\r\n        };\r\n        this.removeDeviceZoomListener = function () {\r\n            var _a, _b;\r\n            if (isMobile()) {\r\n                return;\r\n            }\r\n            (_b = (_a = _this.viewport) === null || _a === void 0 ? void 0 : _a.visualViewport) === null || _b === void 0 ? void 0 : _b.removeEventListener('resize', _this.renderByZoomScale);\r\n        };\r\n        this.renderByDevicePixelRatioChanged = function () {\r\n            _this.renderByDevicePixelRatio();\r\n        };\r\n        this.renderByDevicePixelRatio = function (ratio) {\r\n            if (ratio === void 0) { ratio = window.devicePixelRatio; }\r\n            var _a = _this.spreadsheet, container = _a.container, _b = _a.options, width = _b.width, height = _b.height, devicePixelRatio = _b.devicePixelRatio;\r\n            // 缩放时, 以向上取整后的缩放比为准\r\n            // 设备像素比改变时, 取当前和用户配置中最大的, 保证显示效果\r\n            var pixelRatio = Math.max(ratio, devicePixelRatio, MIN_DEVICE_PIXEL_RATIO);\r\n            container.set('pixelRatio', pixelRatio);\r\n            container.changeSize(width, height);\r\n            _this.spreadsheet.render(false);\r\n        };\r\n        this.renderByZoomScale = debounce(function (event) {\r\n            var ratio = Math.ceil(event.target.scale);\r\n            if (ratio >= 1) {\r\n                _this.renderByDevicePixelRatio(ratio);\r\n            }\r\n        }, 350);\r\n        this.spreadsheet = spreadsheet;\r\n    }\r\n    HdAdapter.prototype.initDevicePixelRatioListener = function () {\r\n        var _a;\r\n        this.devicePixelRatioMedia = window.matchMedia(\"(resolution: \".concat(window.devicePixelRatio, \"dppx)\"));\r\n        if ((_a = this.devicePixelRatioMedia) === null || _a === void 0 ? void 0 : _a.addEventListener) {\r\n            this.devicePixelRatioMedia.addEventListener('change', this.renderByDevicePixelRatioChanged);\r\n        }\r\n        else {\r\n            this.devicePixelRatioMedia.addListener(this.renderByDevicePixelRatioChanged);\r\n        }\r\n    };\r\n    return HdAdapter;\r\n}());\r\nexport { HdAdapter };\r\n//# sourceMappingURL=index.js.map","references":["F:/Ismart/S2-master/node_modules/@types/lodash/index.d.ts","F:/Ismart/S2-master/packages/s2-core/src/common/constant/options.ts","F:/Ismart/S2-master/packages/s2-core/src/utils/is-mobile.ts","F:/Ismart/S2-master/packages/s2-core/src/sheet-type/index.ts"],"map":"{\"version\":3,\"file\":\"index.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/ui/hd-adapter/index.ts\"],\"names\":[],\"mappings\":\"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\"}"}
