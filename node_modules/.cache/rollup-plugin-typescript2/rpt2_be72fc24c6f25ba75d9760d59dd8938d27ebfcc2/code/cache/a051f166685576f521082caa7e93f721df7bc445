{"code":"import { __assign, __extends } from \"tslib\";\r\nimport { getCellMeta } from \"../utils/interaction/select-event\";\r\nimport { getScrollOffsetForCol, getScrollOffsetForRow, } from \"../utils/interaction\";\r\nimport { cloneDeep, isEmpty, isNil, throttle } from 'lodash';\r\nimport { BaseEvent } from './base-interaction';\r\nimport { InterceptType, S2Event, ScrollDirection } from \"../common/constant\";\r\nimport { InteractionBrushSelectionStage, InteractionStateName, BRUSH_AUTO_SCROLL_INITIAL_CONFIG, } from \"../common/constant/interaction\";\r\nimport { DataCell } from \"../cell\";\r\nimport { FRONT_GROUND_GROUP_BRUSH_SELECTION_Z_INDEX } from \"../common/constant\";\r\nimport { getActiveCellsTooltipData } from \"../utils/tooltip\";\r\nimport { isFrozenCol, isFrozenRow, isFrozenTrailingCol, isFrozenTrailingRow, } from \"../facet/utils\";\r\nimport { getValidFrozenOptions } from \"../utils/layout/frozen\";\r\n/**\r\n * Panel area's brush selection interaction\r\n */\r\nvar BrushSelection = /** @class */ (function (_super) {\r\n    __extends(BrushSelection, _super);\r\n    function BrushSelection() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.displayedDataCells = [];\r\n        _this.brushRangeDataCells = [];\r\n        _this.brushSelectionStage = InteractionBrushSelectionStage.UN_DRAGGED;\r\n        _this.brushSelectionMinimumMoveDistance = 5;\r\n        _this.scrollAnimationComplete = true;\r\n        _this.mouseMoveDistanceFromCanvas = 0;\r\n        _this.setMoveDistanceFromCanvas = function (delta, needScrollForX, needScrollForY) {\r\n            var deltaVal = 0;\r\n            if (needScrollForX) {\r\n                deltaVal = delta.x;\r\n            }\r\n            if (needScrollForY) {\r\n                var deltaY = delta.y;\r\n                if (needScrollForX) {\r\n                    deltaVal = Math.max(deltaY, deltaVal);\r\n                }\r\n                else {\r\n                    deltaVal = deltaY;\r\n                }\r\n            }\r\n            _this.mouseMoveDistanceFromCanvas = deltaVal;\r\n        };\r\n        _this.formatBrushPointForScroll = function (delta) {\r\n            var _a, _b;\r\n            var x = delta.x, y = delta.y;\r\n            var facet = _this.spreadsheet.facet;\r\n            var _c = facet.panelBBox, minX = _c.minX, minY = _c.minY, maxX = _c.maxX, maxY = _c.maxY;\r\n            var newX = _this.endBrushPoint.x + x;\r\n            var newY = _this.endBrushPoint.y + y;\r\n            var needScrollForX = true;\r\n            var needScrollForY = true;\r\n            var vScrollBarWidth = (_b = (_a = facet.vScrollBar) === null || _a === void 0 ? void 0 : _a.getBBox()) === null || _b === void 0 ? void 0 : _b.width;\r\n            var extraPixel = 2; // 额外加缩进，保证 getShape 在 panelBox 内\r\n            if (newX > maxX) {\r\n                newX = maxX - vScrollBarWidth - extraPixel;\r\n            }\r\n            else if (newX < minX) {\r\n                newX = minX + extraPixel;\r\n            }\r\n            else {\r\n                needScrollForX = false;\r\n            }\r\n            if (newY > maxY) {\r\n                newY = maxY - extraPixel;\r\n            }\r\n            else if (newY <= minY) {\r\n                newY = minY + extraPixel;\r\n            }\r\n            else {\r\n                needScrollForY = false;\r\n            }\r\n            return {\r\n                x: {\r\n                    value: newX,\r\n                    needScroll: needScrollForX,\r\n                },\r\n                y: {\r\n                    value: newY,\r\n                    needScroll: needScrollForY,\r\n                },\r\n            };\r\n        };\r\n        _this.autoScrollIntervalId = null;\r\n        _this.autoScrollConfig = cloneDeep(BRUSH_AUTO_SCROLL_INITIAL_CONFIG);\r\n        _this.validateYIndex = function (yIndex) {\r\n            var facet = _this.spreadsheet.facet;\r\n            var frozenInfo = facet.frozenGroupInfo;\r\n            var min = 0;\r\n            if (frozenInfo && frozenInfo.row.range) {\r\n                min = frozenInfo.row.range[1] + 1;\r\n            }\r\n            if (yIndex < min)\r\n                return null;\r\n            var max = facet.getCellRange().end;\r\n            if (frozenInfo && frozenInfo.trailingRow.range) {\r\n                max = frozenInfo.trailingRow.range[0] - 1;\r\n            }\r\n            if (yIndex > max) {\r\n                return null;\r\n            }\r\n            return yIndex;\r\n        };\r\n        _this.validateXIndex = function (xIndex) {\r\n            var facet = _this.spreadsheet.facet;\r\n            var frozenInfo = facet.frozenGroupInfo;\r\n            var min = 0;\r\n            if (frozenInfo && frozenInfo.col.range) {\r\n                min = frozenInfo.col.range[1] + 1;\r\n            }\r\n            if (xIndex < min)\r\n                return null;\r\n            var max = facet.layoutResult.colLeafNodes.length - 1;\r\n            if (frozenInfo && frozenInfo.trailingCol.range) {\r\n                max = frozenInfo.trailingCol.range[0] - 1;\r\n            }\r\n            if (xIndex > max) {\r\n                return null;\r\n            }\r\n            return xIndex;\r\n        };\r\n        _this.adjustNextColIndexWithFrozen = function (colIndex, dir) {\r\n            var _a = _this.spreadsheet, facet = _a.facet, dataSet = _a.dataSet, options = _a.options;\r\n            var dataLength = dataSet.getDisplayDataSet().length;\r\n            var colLength = facet.layoutResult.colLeafNodes.length;\r\n            var _b = getValidFrozenOptions(options, colLength, dataLength), frozenTrailingColCount = _b.frozenTrailingColCount, frozenColCount = _b.frozenColCount;\r\n            var panelIndexes = facet.panelScrollGroupIndexes;\r\n            if (frozenTrailingColCount > 0 &&\r\n                dir === ScrollDirection.TRAILING &&\r\n                isFrozenTrailingCol(colIndex, frozenTrailingColCount, colLength)) {\r\n                return panelIndexes[1];\r\n            }\r\n            if (frozenColCount > 0 &&\r\n                dir === ScrollDirection.LEADING &&\r\n                isFrozenCol(colIndex, frozenColCount)) {\r\n                return panelIndexes[0];\r\n            }\r\n            return colIndex;\r\n        };\r\n        _this.adjustNextRowIndexWithFrozen = function (rowIndex, dir) {\r\n            var _a = _this.spreadsheet, facet = _a.facet, dataSet = _a.dataSet, options = _a.options;\r\n            var dataLength = dataSet.getDisplayDataSet().length;\r\n            var colLength = facet.layoutResult.colLeafNodes.length;\r\n            var cellRange = facet.getCellRange();\r\n            var _b = getValidFrozenOptions(options, colLength, dataLength), frozenTrailingRowCount = _b.frozenTrailingRowCount, frozenRowCount = _b.frozenRowCount;\r\n            var panelIndexes = facet.panelScrollGroupIndexes;\r\n            if (frozenTrailingRowCount > 0 &&\r\n                dir === ScrollDirection.TRAILING &&\r\n                isFrozenTrailingRow(rowIndex, cellRange.end, frozenTrailingRowCount)) {\r\n                return panelIndexes[3];\r\n            }\r\n            if (frozenRowCount > 0 &&\r\n                dir === ScrollDirection.LEADING &&\r\n                isFrozenRow(rowIndex, cellRange.start, frozenRowCount)) {\r\n                return panelIndexes[2];\r\n            }\r\n            return rowIndex;\r\n        };\r\n        _this.getNextScrollDelta = function (config) {\r\n            var _a = _this.spreadsheet.facet.getScrollOffset(), scrollX = _a.scrollX, scrollY = _a.scrollY;\r\n            var x = 0;\r\n            var y = 0;\r\n            if (config.y.scroll) {\r\n                var dir = config.y.value > 0 ? ScrollDirection.TRAILING : ScrollDirection.LEADING;\r\n                var rowIndex = _this.adjustNextRowIndexWithFrozen(_this.endBrushPoint.rowIndex, dir);\r\n                var nextIndex = _this.validateYIndex(rowIndex + (config.y.value > 0 ? 1 : -1));\r\n                y = isNil(nextIndex)\r\n                    ? 0\r\n                    : getScrollOffsetForRow(nextIndex, dir, _this.spreadsheet) - scrollY;\r\n            }\r\n            if (config.x.scroll) {\r\n                var dir = config.x.value > 0 ? ScrollDirection.TRAILING : ScrollDirection.LEADING;\r\n                var colIndex = _this.adjustNextColIndexWithFrozen(_this.endBrushPoint.colIndex, dir);\r\n                var nextIndex = _this.validateXIndex(colIndex + (config.x.value > 0 ? 1 : -1));\r\n                x = isNil(nextIndex)\r\n                    ? 0\r\n                    : getScrollOffsetForCol(nextIndex, dir, _this.spreadsheet) - scrollX;\r\n            }\r\n            return {\r\n                x: x,\r\n                y: y,\r\n            };\r\n        };\r\n        _this.onScrollAnimationComplete = function () {\r\n            _this.scrollAnimationComplete = true;\r\n            if (_this.brushSelectionStage !== InteractionBrushSelectionStage.UN_DRAGGED) {\r\n                _this.renderPrepareSelected(_this.endBrushPoint);\r\n            }\r\n        };\r\n        _this.autoScroll = function () {\r\n            if (_this.brushSelectionStage === InteractionBrushSelectionStage.UN_DRAGGED ||\r\n                !_this.scrollAnimationComplete) {\r\n                return;\r\n            }\r\n            var config = _this.autoScrollConfig;\r\n            var scrollOffset = _this.spreadsheet.facet.getScrollOffset();\r\n            var offsetCfg = {\r\n                offsetX: {\r\n                    value: scrollOffset.scrollX,\r\n                    animate: true,\r\n                },\r\n                offsetY: {\r\n                    value: scrollOffset.scrollY,\r\n                    animate: true,\r\n                },\r\n            };\r\n            var _a = _this.getNextScrollDelta(config), deltaX = _a.x, deltaY = _a.y;\r\n            if (deltaY === 0 && deltaX === 0) {\r\n                _this.clearAutoScroll();\r\n                return;\r\n            }\r\n            if (config.y.scroll) {\r\n                offsetCfg.offsetY.value += deltaY;\r\n            }\r\n            if (config.x.scroll) {\r\n                offsetCfg.offsetX.value += deltaX;\r\n                if (offsetCfg.offsetX.value < 0) {\r\n                    offsetCfg.offsetX.value = 0;\r\n                }\r\n            }\r\n            _this.scrollAnimationComplete = false;\r\n            var ratio = 3;\r\n            // x 轴滚动速度慢\r\n            if (config.x.scroll) {\r\n                ratio = 1;\r\n            }\r\n            _this.spreadsheet.facet.scrollWithAnimation(offsetCfg, Math.max(16, 300 - _this.mouseMoveDistanceFromCanvas * ratio), _this.onScrollAnimationComplete);\r\n        };\r\n        _this.handleScroll = throttle(function (x, y) {\r\n            if (_this.brushSelectionStage === InteractionBrushSelectionStage.UN_DRAGGED) {\r\n                return;\r\n            }\r\n            var _a = _this.formatBrushPointForScroll({ x: x, y: y }), _b = _a.x, newX = _b.value, needScrollForX = _b.needScroll, _c = _a.y, newY = _c.value, needScrollForY = _c.needScroll;\r\n            var config = _this.autoScrollConfig;\r\n            if (needScrollForY) {\r\n                config.y.value = y;\r\n                config.y.scroll = true;\r\n            }\r\n            if (needScrollForX) {\r\n                config.x.value = x;\r\n                config.x.scroll = true;\r\n            }\r\n            _this.setMoveDistanceFromCanvas({ x: x, y: y }, needScrollForX, needScrollForY);\r\n            _this.renderPrepareSelected({\r\n                x: newX,\r\n                y: newY,\r\n            });\r\n            if (needScrollForY || needScrollForX) {\r\n                _this.clearAutoScroll();\r\n                _this.autoScroll();\r\n                _this.autoScrollIntervalId = setInterval(_this.autoScroll, 16);\r\n            }\r\n        }, 30);\r\n        _this.clearAutoScroll = function () {\r\n            if (_this.autoScrollIntervalId) {\r\n                clearInterval(_this.autoScrollIntervalId);\r\n                _this.autoScrollIntervalId = null;\r\n                _this.resetScrollDelta();\r\n            }\r\n        };\r\n        _this.renderPrepareSelected = function (point) {\r\n            var x = point.x, y = point.y;\r\n            var target = _this.spreadsheet.container.getShape(x, y);\r\n            var cell = _this.spreadsheet.getCell(target);\r\n            if (!cell || !(cell instanceof DataCell)) {\r\n                return;\r\n            }\r\n            var _a = cell.getMeta(), rowIndex = _a.rowIndex, colIndex = _a.colIndex;\r\n            _this.endBrushPoint = {\r\n                x: x,\r\n                y: y,\r\n                rowIndex: rowIndex,\r\n                colIndex: colIndex,\r\n            };\r\n            var interaction = _this.spreadsheet.interaction;\r\n            interaction.addIntercepts([InterceptType.HOVER]);\r\n            interaction.clearStyleIndependent();\r\n            _this.updatePrepareSelectMask();\r\n            _this.showPrepareSelectedCells();\r\n        };\r\n        // 刷选过程中高亮的cell\r\n        _this.showPrepareSelectedCells = function () {\r\n            var brushRangeDataCells = _this.getBrushRangeDataCells();\r\n            _this.spreadsheet.interaction.changeState({\r\n                cells: brushRangeDataCells.map(function (item) { return getCellMeta(item); }),\r\n                stateName: InteractionStateName.PREPARE_SELECT,\r\n                // 刷选首先会经过 hover => mousedown => mousemove, hover时会将当前行全部高亮 (row cell + data cell)\r\n                // 如果是有效刷选, 更新时会重新渲染, hover 高亮的格子 会正常重置\r\n                // 如果是无效刷选(全部都是没数据的格子), brushRangeDataCells = [], 更新时会跳过, 需要强制重置 hover 高亮\r\n                force: true,\r\n            });\r\n            _this.brushRangeDataCells = brushRangeDataCells;\r\n        };\r\n        _this.getSelectedCellMetas = function (range) {\r\n            var _a;\r\n            var metas = [];\r\n            var colLeafNodes = _this.spreadsheet.facet.layoutResult.colLeafNodes;\r\n            var rowLeafNodes = (_a = _this.spreadsheet.facet.layoutResult.rowLeafNodes) !== null && _a !== void 0 ? _a : [];\r\n            for (var rowIndex = range.start.rowIndex; rowIndex < range.end.rowIndex + 1; rowIndex++) {\r\n                for (var colIndex = range.start.colIndex; colIndex < range.end.colIndex + 1; colIndex++) {\r\n                    var colId = colLeafNodes[colIndex].id;\r\n                    var rowId = String(rowIndex);\r\n                    if (rowLeafNodes.length) {\r\n                        rowId = rowLeafNodes[rowIndex].id;\r\n                    }\r\n                    metas.push({\r\n                        colIndex: colIndex,\r\n                        rowIndex: rowIndex,\r\n                        id: \"\".concat(rowId, \"-\").concat(colId),\r\n                        type: 'dataCell',\r\n                    });\r\n                }\r\n            }\r\n            return metas;\r\n        };\r\n        return _this;\r\n    }\r\n    BrushSelection.prototype.bindEvents = function () {\r\n        this.bindMouseDown();\r\n        this.bindMouseMove();\r\n        this.bindMouseUp();\r\n    };\r\n    BrushSelection.prototype.getPrepareSelectMaskTheme = function () {\r\n        var _a;\r\n        return (_a = this.spreadsheet.theme) === null || _a === void 0 ? void 0 : _a.prepareSelectMask;\r\n    };\r\n    BrushSelection.prototype.initPrepareSelectMaskShape = function () {\r\n        var foregroundGroup = this.spreadsheet.foregroundGroup;\r\n        if (!foregroundGroup) {\r\n            return;\r\n        }\r\n        foregroundGroup.removeChild(this.prepareSelectMaskShape);\r\n        var prepareSelectMaskTheme = this.getPrepareSelectMaskTheme();\r\n        this.prepareSelectMaskShape = foregroundGroup.addShape('rect', {\r\n            visible: false,\r\n            attrs: {\r\n                width: 0,\r\n                height: 0,\r\n                x: 0,\r\n                y: 0,\r\n                fill: prepareSelectMaskTheme === null || prepareSelectMaskTheme === void 0 ? void 0 : prepareSelectMaskTheme.backgroundColor,\r\n                fillOpacity: prepareSelectMaskTheme === null || prepareSelectMaskTheme === void 0 ? void 0 : prepareSelectMaskTheme.backgroundOpacity,\r\n                zIndex: FRONT_GROUND_GROUP_BRUSH_SELECTION_Z_INDEX,\r\n            },\r\n            capture: false,\r\n        });\r\n    };\r\n    BrushSelection.prototype.setBrushSelectionStage = function (stage) {\r\n        this.brushSelectionStage = stage;\r\n    };\r\n    BrushSelection.prototype.bindMouseDown = function () {\r\n        var _this = this;\r\n        this.spreadsheet.on(S2Event.DATA_CELL_MOUSE_DOWN, function (event) {\r\n            var _a;\r\n            (_a = event === null || event === void 0 ? void 0 : event.preventDefault) === null || _a === void 0 ? void 0 : _a.call(event);\r\n            if (_this.spreadsheet.interaction.hasIntercepts([InterceptType.CLICK])) {\r\n                return;\r\n            }\r\n            _this.setBrushSelectionStage(InteractionBrushSelectionStage.CLICK);\r\n            _this.initPrepareSelectMaskShape();\r\n            _this.setDisplayedDataCells();\r\n            _this.startBrushPoint = _this.getBrushPoint(event);\r\n            _this.resetScrollDelta();\r\n        });\r\n    };\r\n    BrushSelection.prototype.isPointInCanvas = function (point) {\r\n        var _a = this.spreadsheet.facet.getCanvasHW(), height = _a.height, width = _a.width;\r\n        var _b = this.spreadsheet.facet.panelBBox, minX = _b.minX, minY = _b.minY;\r\n        return (point.x > minX && point.x < width && point.y > minY && point.y < height);\r\n    };\r\n    BrushSelection.prototype.bindMouseMove = function () {\r\n        var _this = this;\r\n        this.spreadsheet.on(S2Event.GLOBAL_MOUSE_MOVE, function (event) {\r\n            if (_this.brushSelectionStage === InteractionBrushSelectionStage.UN_DRAGGED) {\r\n                return;\r\n            }\r\n            _this.setBrushSelectionStage(InteractionBrushSelectionStage.DRAGGED);\r\n            var pointInCanvas = _this.spreadsheet.container.getPointByEvent(event);\r\n            _this.clearAutoScroll();\r\n            if (!_this.isPointInCanvas(pointInCanvas)) {\r\n                var deltaX = pointInCanvas.x - _this.endBrushPoint.x;\r\n                var deltaY = pointInCanvas.y - _this.endBrushPoint.y;\r\n                _this.handleScroll(deltaX, deltaY);\r\n                return;\r\n            }\r\n            _this.renderPrepareSelected(pointInCanvas);\r\n        });\r\n    };\r\n    BrushSelection.prototype.bindMouseUp = function () {\r\n        var _this = this;\r\n        // 使用全局的 mouseup, 而不是 canvas 的 mouse up 防止刷选过程中移出表格区域时无法响应事件\r\n        this.spreadsheet.on(S2Event.GLOBAL_MOUSE_UP, function (event) {\r\n            _this.clearAutoScroll();\r\n            if (_this.isValidBrushSelection()) {\r\n                _this.spreadsheet.interaction.addIntercepts([\r\n                    InterceptType.BRUSH_SELECTION,\r\n                ]);\r\n                _this.updateSelectedCells();\r\n                _this.spreadsheet.showTooltipWithInfo(event, getActiveCellsTooltipData(_this.spreadsheet));\r\n            }\r\n            _this.resetDrag();\r\n        });\r\n        // 刷选过程中右键弹出系统菜单时, 应该重置刷选, 防止系统菜单关闭后 mouse up 未相应依然是刷选状态\r\n        this.spreadsheet.on(S2Event.GLOBAL_CONTEXT_MENU, function () {\r\n            if (_this.brushSelectionStage === InteractionBrushSelectionStage.UN_DRAGGED) {\r\n                return;\r\n            }\r\n            _this.spreadsheet.interaction.removeIntercepts([InterceptType.HOVER]);\r\n            _this.resetDrag();\r\n        });\r\n    };\r\n    BrushSelection.prototype.resetDrag = function () {\r\n        this.hidePrepareSelectMaskShape();\r\n        this.setBrushSelectionStage(InteractionBrushSelectionStage.UN_DRAGGED);\r\n    };\r\n    BrushSelection.prototype.isValidBrushSelection = function () {\r\n        if (this.brushSelectionStage !== InteractionBrushSelectionStage.DRAGGED) {\r\n            return false;\r\n        }\r\n        var _a = this.getBrushRange(), start = _a.start, end = _a.end;\r\n        var isMovedEnoughDistance = end.x - start.x > this.brushSelectionMinimumMoveDistance ||\r\n            end.y - start.y > this.brushSelectionMinimumMoveDistance;\r\n        return isMovedEnoughDistance;\r\n    };\r\n    BrushSelection.prototype.setDisplayedDataCells = function () {\r\n        this.displayedDataCells =\r\n            this.spreadsheet.interaction.getPanelGroupAllDataCells();\r\n    };\r\n    BrushSelection.prototype.updatePrepareSelectMask = function () {\r\n        var brushRange = this.getBrushRange();\r\n        this.prepareSelectMaskShape.attr({\r\n            x: brushRange.start.x,\r\n            y: brushRange.start.y,\r\n            width: brushRange.width,\r\n            height: brushRange.height,\r\n        });\r\n        this.prepareSelectMaskShape.show();\r\n    };\r\n    BrushSelection.prototype.hidePrepareSelectMaskShape = function () {\r\n        var _a;\r\n        (_a = this.prepareSelectMaskShape) === null || _a === void 0 ? void 0 : _a.hide();\r\n    };\r\n    BrushSelection.prototype.resetScrollDelta = function () {\r\n        this.autoScrollConfig = cloneDeep(BRUSH_AUTO_SCROLL_INITIAL_CONFIG);\r\n    };\r\n    BrushSelection.prototype.getBrushPoint = function (event) {\r\n        var _a = this.spreadsheet.facet.getScrollOffset(), scrollY = _a.scrollY, scrollX = _a.scrollX;\r\n        var originalEvent = event.originalEvent;\r\n        var point = {\r\n            x: originalEvent === null || originalEvent === void 0 ? void 0 : originalEvent.layerX,\r\n            y: originalEvent === null || originalEvent === void 0 ? void 0 : originalEvent.layerY,\r\n        };\r\n        var cell = this.spreadsheet.getCell(event.target);\r\n        var _b = cell.getMeta(), colIndex = _b.colIndex, rowIndex = _b.rowIndex;\r\n        return __assign(__assign({}, point), { rowIndex: rowIndex, colIndex: colIndex, scrollY: scrollY, scrollX: scrollX });\r\n    };\r\n    // 四个刷选方向: 左 => 右, 右 => 左, 上 => 下, 下 => 上, 将最终结果进行重新排序, 获取真实的 row, col index\r\n    BrushSelection.prototype.getBrushRange = function () {\r\n        var _a = this.spreadsheet.facet.getScrollOffset(), scrollX = _a.scrollX, scrollY = _a.scrollY;\r\n        var minRowIndex = Math.min(this.startBrushPoint.rowIndex, this.endBrushPoint.rowIndex);\r\n        var maxRowIndex = Math.max(this.startBrushPoint.rowIndex, this.endBrushPoint.rowIndex);\r\n        var minColIndex = Math.min(this.startBrushPoint.colIndex, this.endBrushPoint.colIndex);\r\n        var maxColIndex = Math.max(this.startBrushPoint.colIndex, this.endBrushPoint.colIndex);\r\n        var startXInView = this.startBrushPoint.x + this.startBrushPoint.scrollX - scrollX;\r\n        var startYInView = this.startBrushPoint.y + this.startBrushPoint.scrollY - scrollY;\r\n        // startBrushPoint 和 endBrushPoint 加上当前 offset\r\n        var minX = Math.min(startXInView, this.endBrushPoint.x);\r\n        var maxX = Math.max(startXInView, this.endBrushPoint.x);\r\n        var minY = Math.min(startYInView, this.endBrushPoint.y);\r\n        var maxY = Math.max(startYInView, this.endBrushPoint.y);\r\n        return {\r\n            start: {\r\n                rowIndex: minRowIndex,\r\n                colIndex: minColIndex,\r\n                x: minX,\r\n                y: minY,\r\n            },\r\n            end: {\r\n                rowIndex: maxRowIndex,\r\n                colIndex: maxColIndex,\r\n                x: maxX,\r\n                y: maxY,\r\n            },\r\n            width: maxX - minX,\r\n            height: maxY - minY,\r\n        };\r\n    };\r\n    BrushSelection.prototype.isInBrushRange = function (meta) {\r\n        var _a = this.getBrushRange(), start = _a.start, end = _a.end;\r\n        var rowIndex = meta.rowIndex, colIndex = meta.colIndex;\r\n        return (rowIndex >= start.rowIndex &&\r\n            rowIndex <= end.rowIndex &&\r\n            colIndex >= start.colIndex &&\r\n            colIndex <= end.colIndex);\r\n    };\r\n    // 获取对角线的两个坐标, 得到对应矩阵并且有数据的单元格\r\n    BrushSelection.prototype.getBrushRangeDataCells = function () {\r\n        var _this = this;\r\n        this.setDisplayedDataCells();\r\n        return this.displayedDataCells.filter(function (cell) {\r\n            var meta = cell.getMeta();\r\n            return _this.isInBrushRange(meta);\r\n        });\r\n    };\r\n    // 最终刷选的cell\r\n    BrushSelection.prototype.updateSelectedCells = function () {\r\n        var interaction = this.spreadsheet.interaction;\r\n        var range = this.getBrushRange();\r\n        interaction.changeState({\r\n            cells: this.getSelectedCellMetas(range),\r\n            stateName: InteractionStateName.SELECTED,\r\n        });\r\n        this.spreadsheet.emit(S2Event.DATE_CELL_BRUSH_SELECTION, this.brushRangeDataCells);\r\n        this.spreadsheet.emit(S2Event.GLOBAL_SELECTED, this.brushRangeDataCells);\r\n        // 未刷选到有效格子, 允许 hover\r\n        if (isEmpty(this.brushRangeDataCells)) {\r\n            interaction.removeIntercepts([InterceptType.HOVER]);\r\n        }\r\n    };\r\n    return BrushSelection;\r\n}(BaseEvent));\r\nexport { BrushSelection };\r\n//# sourceMappingURL=brush-selection.js.map","references":["F:/Ismart/S2-master/node_modules/@antv/g-canvas/lib/index.d.ts","F:/Ismart/S2-master/packages/s2-core/src/utils/interaction/select-event.ts","F:/Ismart/S2-master/packages/s2-core/src/utils/interaction/index.ts","F:/Ismart/S2-master/node_modules/@types/lodash/index.d.ts","F:/Ismart/S2-master/packages/s2-core/src/interaction/base-event.ts","F:/Ismart/S2-master/packages/s2-core/src/interaction/base-interaction/index.ts","F:/Ismart/S2-master/packages/s2-core/src/common/constant/index.ts","F:/Ismart/S2-master/packages/s2-core/src/common/constant/interaction.ts","F:/Ismart/S2-master/packages/s2-core/src/common/interface/index.ts","F:/Ismart/S2-master/packages/s2-core/src/cell/index.ts","F:/Ismart/S2-master/packages/s2-core/src/common/constant/index.ts","F:/Ismart/S2-master/packages/s2-core/src/utils/tooltip.ts","F:/Ismart/S2-master/packages/s2-core/src/facet/utils.ts","F:/Ismart/S2-master/packages/s2-core/src/utils/layout/frozen.ts","F:/Ismart/S2-master/packages/s2-core/src/facet/index.ts"],"map":"{\"version\":3,\"file\":\"brush-selection.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/interaction/brush-selection.ts\"],\"names\":[],\"mappings\":\"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\"}"}
