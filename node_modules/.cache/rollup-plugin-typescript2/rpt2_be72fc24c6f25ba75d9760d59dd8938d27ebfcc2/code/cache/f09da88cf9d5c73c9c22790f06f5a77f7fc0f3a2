{"code":"import { compact, find, get, identity, isNil, map, max, memoize, min, } from 'lodash';\r\nimport { getValueRangeState, setValueRangeState, } from \"../utils/condition/state-controller\";\r\nvar BaseDataSet = /** @class */ (function () {\r\n    function BaseDataSet(spreadsheet) {\r\n        var _this = this;\r\n        /**\r\n         * 查找字段信息\r\n         */\r\n        this.getFieldMeta = memoize(function (field, meta) {\r\n            return find(_this.meta || meta, function (m) { return m.field === field; });\r\n        });\r\n        this.spreadsheet = spreadsheet;\r\n    }\r\n    /**\r\n     * 获得字段名称\r\n     * @param field\r\n     */\r\n    BaseDataSet.prototype.getFieldName = function (field) {\r\n        return get(this.getFieldMeta(field, this.meta), 'name', field);\r\n    };\r\n    /**\r\n     * 获得字段格式方法\r\n     * @param field\r\n     */\r\n    BaseDataSet.prototype.getFieldFormatter = function (field) {\r\n        return get(this.getFieldMeta(field, this.meta), 'formatter', identity);\r\n    };\r\n    /**\r\n     * 获得字段描述\r\n     * @param field\r\n     */\r\n    BaseDataSet.prototype.getFieldDescription = function (field) {\r\n        return get(this.getFieldMeta(field, this.meta), 'description');\r\n    };\r\n    BaseDataSet.prototype.setDataCfg = function (dataCfg) {\r\n        this.getFieldMeta.cache.clear();\r\n        var _a = this.processDataCfg(dataCfg), fields = _a.fields, meta = _a.meta, data = _a.data, totalData = _a.totalData, sortParams = _a.sortParams, filterParams = _a.filterParams;\r\n        this.fields = fields;\r\n        this.meta = meta;\r\n        this.originData = data;\r\n        this.totalData = totalData;\r\n        this.sortParams = sortParams;\r\n        this.filterParams = filterParams;\r\n        this.displayData = this.originData;\r\n        this.indexesData = [];\r\n    };\r\n    BaseDataSet.prototype.getDisplayDataSet = function () {\r\n        return this.displayData;\r\n    };\r\n    BaseDataSet.prototype.getValueRangeByField = function (field) {\r\n        var _a;\r\n        var cacheRange = getValueRangeState(this.spreadsheet, field);\r\n        if (cacheRange) {\r\n            return cacheRange;\r\n        }\r\n        var fieldValues = compact(map(this.originData, function (item) {\r\n            var value = item[field];\r\n            return isNil(value) ? null : Number.parseFloat(value);\r\n        }));\r\n        var range = {\r\n            maxValue: max(fieldValues),\r\n            minValue: min(fieldValues),\r\n        };\r\n        setValueRangeState(this.spreadsheet, (_a = {},\r\n            _a[field] = range,\r\n            _a));\r\n        return range;\r\n    };\r\n    BaseDataSet.prototype.moreThanOneValue = function () {\r\n        var _a, _b;\r\n        return ((_b = (_a = this.fields) === null || _a === void 0 ? void 0 : _a.values) === null || _b === void 0 ? void 0 : _b.length) > 1;\r\n    };\r\n    return BaseDataSet;\r\n}());\r\nexport { BaseDataSet };\r\n//# sourceMappingURL=base-data-set.js.map","references":["F:/Ismart/S2-master/node_modules/@types/lodash/index.d.ts","F:/Ismart/S2-master/packages/s2-core/src/common/interface/index.ts","F:/Ismart/S2-master/packages/s2-core/src/common/interface/condition.ts","F:/Ismart/S2-master/packages/s2-core/src/data-set/interface.ts","F:/Ismart/S2-master/packages/s2-core/src/sheet-type/index.ts","F:/Ismart/S2-master/packages/s2-core/src/utils/condition/state-controller.ts"],"map":"{\"version\":3,\"file\":\"base-data-set.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/data-set/base-data-set.ts\"],\"names\":[],\"mappings\":\"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\"}"}
