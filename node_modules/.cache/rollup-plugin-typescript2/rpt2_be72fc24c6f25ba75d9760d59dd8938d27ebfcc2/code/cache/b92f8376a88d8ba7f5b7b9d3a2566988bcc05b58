{"code":"import { __assign, __extends } from \"tslib\";\r\nimport { getCellMeta } from \"../../utils/interaction/select-event\";\r\nimport { isEmpty, forEach, isEqual } from 'lodash';\r\nimport { BaseEvent } from '../base-event';\r\nimport { S2Event } from \"../../common/constant\";\r\nimport { HOVER_FOCUS_TIME, InteractionStateName, InterceptType, } from \"../../common/constant/interaction\";\r\nimport { getActiveHoverRowColCells } from \"../../utils/interaction/hover-event\";\r\n/**\r\n * @description Hover event for data cells, row cells and col cells\r\n */\r\nvar HoverEvent = /** @class */ (function (_super) {\r\n    __extends(HoverEvent, _super);\r\n    function HoverEvent() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    HoverEvent.prototype.bindEvents = function () {\r\n        this.bindDataCellHover();\r\n        this.bindRowCellHover();\r\n        this.bindColCellHover();\r\n    };\r\n    HoverEvent.prototype.updateRowColCells = function (meta) {\r\n        var rowId = meta.rowId, colId = meta.colId;\r\n        var interaction = this.spreadsheet.interaction;\r\n        if (colId) {\r\n            // update colHeader cells\r\n            var allColHeaderCells = getActiveHoverRowColCells(colId, interaction.getAllColHeaderCells());\r\n            forEach(allColHeaderCells, function (cell) {\r\n                cell.updateByState(InteractionStateName.HOVER);\r\n            });\r\n        }\r\n        if (rowId) {\r\n            // update rowHeader cells\r\n            var allRowHeaderCells = getActiveHoverRowColCells(rowId, interaction.getAllRowHeaderCells(), this.spreadsheet.isHierarchyTreeType());\r\n            forEach(allRowHeaderCells, function (cell) {\r\n                cell.updateByState(InteractionStateName.HOVER);\r\n            });\r\n        }\r\n    };\r\n    /**\r\n     * @description change the data cell state from hover to hover focus\r\n     * @param cell\r\n     * @param event\r\n     * @param meta\r\n     */\r\n    HoverEvent.prototype.changeStateToHoverFocus = function (cell, event, meta) {\r\n        var _this = this;\r\n        var interaction = this.spreadsheet.interaction;\r\n        interaction.clearHoverTimer();\r\n        var hoverTimer = setTimeout(function () {\r\n            if (interaction.hasIntercepts([InterceptType.HOVER])) {\r\n                return;\r\n            }\r\n            interaction.changeState({\r\n                cells: [getCellMeta(cell)],\r\n                stateName: InteractionStateName.HOVER_FOCUS,\r\n            });\r\n            var showSingleTips = _this.spreadsheet.isTableMode();\r\n            var options = {\r\n                isTotals: meta.isTotals,\r\n                enterable: true,\r\n                hideSummary: true,\r\n                showSingleTips: showSingleTips,\r\n            };\r\n            var data = _this.getCellInfo(meta, showSingleTips);\r\n            _this.spreadsheet.showTooltipWithInfo(event, data, options);\r\n        }, HOVER_FOCUS_TIME);\r\n        interaction.setHoverTimer(hoverTimer);\r\n    };\r\n    /**\r\n     * @description handle the row or column header hover state\r\n     * @param event\r\n     */\r\n    HoverEvent.prototype.handleHeaderHover = function (event) {\r\n        var cell = this.spreadsheet.getCell(event.target);\r\n        if (isEmpty(cell)) {\r\n            return;\r\n        }\r\n        var interaction = this.spreadsheet.interaction;\r\n        var activeCells = interaction.getActiveCells();\r\n        interaction.clearHoverTimer();\r\n        // 避免在统一单元格内鼠标移动造成的多次渲染\r\n        if (isEqual(activeCells === null || activeCells === void 0 ? void 0 : activeCells[0], cell)) {\r\n            return;\r\n        }\r\n        var meta = cell.getMeta();\r\n        interaction.changeState({\r\n            cells: [getCellMeta(cell)],\r\n            stateName: InteractionStateName.HOVER,\r\n        });\r\n        cell.update();\r\n        if (cell.getActualText() !== cell.getFieldValue()) {\r\n            var showSingleTips = true;\r\n            var options = {\r\n                isTotals: meta.isTotals,\r\n                enterable: true,\r\n                hideSummary: true,\r\n                showSingleTips: showSingleTips,\r\n                enableFormat: this.spreadsheet.isPivotMode(),\r\n            };\r\n            var data = this.getCellInfo(meta, showSingleTips);\r\n            this.spreadsheet.showTooltipWithInfo(event, data, options);\r\n        }\r\n    };\r\n    HoverEvent.prototype.getCellInfo = function (meta, showSingleTips) {\r\n        if (meta === void 0) { meta = {}; }\r\n        var data = meta.data, query = meta.query, value = meta.value, field = meta.field, fieldValue = meta.fieldValue, valueField = meta.valueField, rowQuery = meta.rowQuery, colQuery = meta.colQuery;\r\n        var currentCellMeta = data;\r\n        var cellInfos = showSingleTips\r\n            ? [\r\n                __assign(__assign({}, query), { value: value || fieldValue, valueField: field || valueField }),\r\n            ]\r\n            : [currentCellMeta || __assign(__assign({}, rowQuery), colQuery)];\r\n        return cellInfos;\r\n    };\r\n    HoverEvent.prototype.bindDataCellHover = function () {\r\n        var _this = this;\r\n        this.spreadsheet.on(S2Event.DATA_CELL_HOVER, function (event) {\r\n            var cell = _this.spreadsheet.getCell(event.target);\r\n            if (isEmpty(cell)) {\r\n                return;\r\n            }\r\n            var _a = _this.spreadsheet, interaction = _a.interaction, options = _a.options;\r\n            var interactionOptions = options.interaction;\r\n            var meta = cell === null || cell === void 0 ? void 0 : cell.getMeta();\r\n            interaction.changeState({\r\n                cells: [getCellMeta(cell)],\r\n                stateName: InteractionStateName.HOVER,\r\n            });\r\n            if (interactionOptions.hoverHighlight) {\r\n                // highlight all the row and column cells which the cell belongs to\r\n                _this.updateRowColCells(meta);\r\n            }\r\n            if (interactionOptions.hoverFocus) {\r\n                _this.changeStateToHoverFocus(cell, event, meta);\r\n            }\r\n        });\r\n    };\r\n    HoverEvent.prototype.bindRowCellHover = function () {\r\n        var _this = this;\r\n        this.spreadsheet.on(S2Event.ROW_CELL_HOVER, function (event) {\r\n            _this.handleHeaderHover(event);\r\n        });\r\n    };\r\n    HoverEvent.prototype.bindColCellHover = function () {\r\n        var _this = this;\r\n        this.spreadsheet.on(S2Event.COL_CELL_HOVER, function (event) {\r\n            _this.handleHeaderHover(event);\r\n        });\r\n    };\r\n    return HoverEvent;\r\n}(BaseEvent));\r\nexport { HoverEvent };\r\n//# sourceMappingURL=hover.js.map","references":["F:/Ismart/S2-master/node_modules/@antv/g-canvas/lib/index.d.ts","F:/Ismart/S2-master/packages/s2-core/src/utils/interaction/select-event.ts","F:/Ismart/S2-master/node_modules/@types/lodash/index.d.ts","F:/Ismart/S2-master/packages/s2-core/src/interaction/base-event.ts","F:/Ismart/S2-master/packages/s2-core/src/cell/index.ts","F:/Ismart/S2-master/packages/s2-core/src/common/constant/index.ts","F:/Ismart/S2-master/packages/s2-core/src/common/constant/interaction.ts","F:/Ismart/S2-master/packages/s2-core/src/common/interface/index.ts","F:/Ismart/S2-master/packages/s2-core/src/utils/interaction/hover-event.ts"],"map":"{\"version\":3,\"file\":\"hover.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/interaction/base-interaction/hover.ts\"],\"names\":[],\"mappings\":\"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\"}"}
