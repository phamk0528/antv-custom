{"code":"import { __assign, __extends, __read, __spreadArray } from \"tslib\";\r\nimport { each, orderBy, filter, includes, isFunction } from 'lodash';\r\nimport { isAscSort, isDescSort } from '..';\r\nimport { BaseDataSet } from \"./base-data-set\";\r\nvar TableDataSet = /** @class */ (function (_super) {\r\n    __extends(TableDataSet, _super);\r\n    function TableDataSet() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.handleDimensionValueFilter = function () {\r\n            each(_this.filterParams, function (_a) {\r\n                var filterKey = _a.filterKey, filteredValues = _a.filteredValues, customFilter = _a.customFilter;\r\n                var defaultFilterFunc = function (row) {\r\n                    return row[filterKey] && !includes(filteredValues, row[filterKey]);\r\n                };\r\n                _this.displayData = __spreadArray(__spreadArray(__spreadArray([], __read(_this.getStartRows()), false), __read(filter(_this.getMovableRows(), function (row) {\r\n                    if (customFilter) {\r\n                        return customFilter(row) && defaultFilterFunc(row);\r\n                    }\r\n                    return defaultFilterFunc(row);\r\n                })), false), __read(_this.getEndRows()), false);\r\n            });\r\n        };\r\n        //  sortFunc > sortBy > sortFieldId\r\n        _this.handleDimensionValuesSort = function () {\r\n            each(_this.sortParams, function (item) {\r\n                var sortFieldId = item.sortFieldId, sortBy = item.sortBy, sortFunc = item.sortFunc, sortMethod = item.sortMethod, query = item.query;\r\n                // 排序的前提\r\n                if (!sortFieldId)\r\n                    return;\r\n                var data = _this.getMovableRows();\r\n                var restData = [];\r\n                if (query) {\r\n                    var scopedData_1 = [];\r\n                    data.forEach(function (record) {\r\n                        var keys = Object.keys(query);\r\n                        var inScope = true;\r\n                        for (var index = 0; index < keys.length; index++) {\r\n                            var k = keys[index];\r\n                            if (record[k] !== query[k]) {\r\n                                inScope = false;\r\n                                restData.push(record);\r\n                                break;\r\n                            }\r\n                        }\r\n                        if (inScope) {\r\n                            scopedData_1.push(record);\r\n                        }\r\n                    });\r\n                    data = scopedData_1;\r\n                }\r\n                var sortedData = data;\r\n                if (sortFunc) {\r\n                    sortedData = sortFunc(__assign(__assign({}, item), { data: data }));\r\n                }\r\n                else if (sortBy && !isFunction(sortBy)) {\r\n                    var reversedSortBy_1 = __spreadArray([], __read(sortBy), false).reverse();\r\n                    sortedData = data.sort(function (a, b) {\r\n                        var idxA = reversedSortBy_1.indexOf(a[sortFieldId]);\r\n                        var idxB = reversedSortBy_1.indexOf(b[sortFieldId]);\r\n                        return idxB - idxA;\r\n                    });\r\n                }\r\n                else if (isAscSort(sortMethod) || isDescSort(sortMethod)) {\r\n                    var func = isFunction(sortBy) ? sortBy : null;\r\n                    sortedData = orderBy(data, [func || sortFieldId], [sortMethod.toLocaleLowerCase()]);\r\n                }\r\n                if (restData.length) {\r\n                    sortedData = __spreadArray(__spreadArray([], __read(sortedData), false), __read(restData), false);\r\n                }\r\n                // For frozen options\r\n                _this.displayData = __spreadArray(__spreadArray(__spreadArray([], __read(_this.getStartRows()), false), __read(sortedData), false), __read(_this.getEndRows()), false);\r\n            });\r\n        };\r\n        return _this;\r\n    }\r\n    TableDataSet.prototype.processDataCfg = function (dataCfg) {\r\n        return dataCfg;\r\n    };\r\n    TableDataSet.prototype.setDataCfg = function (dataCfg) {\r\n        _super.prototype.setDataCfg.call(this, dataCfg);\r\n        this.handleDimensionValueFilter();\r\n        this.handleDimensionValuesSort();\r\n    };\r\n    /**\r\n     * 返回顶部冻结行\r\n     * @returns\r\n     */\r\n    TableDataSet.prototype.getStartRows = function () {\r\n        var frozenRowCount = (this.spreadsheet.options || {}).frozenRowCount;\r\n        if (!frozenRowCount)\r\n            return [];\r\n        var displayData = this.displayData;\r\n        return displayData.slice(0, frozenRowCount);\r\n    };\r\n    /**\r\n     * 返回底部冻结行\r\n     * @returns\r\n     */\r\n    TableDataSet.prototype.getEndRows = function () {\r\n        var frozenTrailingRowCount = (this.spreadsheet.options || {}).frozenTrailingRowCount;\r\n        // 没有冻结行时返回空数组\r\n        if (!frozenTrailingRowCount)\r\n            return [];\r\n        var displayData = this.displayData;\r\n        return displayData.slice(-frozenTrailingRowCount);\r\n    };\r\n    /**\r\n     * 返回可移动的非冻结行\r\n     * @returns\r\n     */\r\n    TableDataSet.prototype.getMovableRows = function () {\r\n        var displayData = this.displayData;\r\n        var _a = this.spreadsheet.options || {}, frozenTrailingRowCount = _a.frozenTrailingRowCount, frozenRowCount = _a.frozenRowCount;\r\n        return displayData.slice(frozenRowCount || 0, -frozenTrailingRowCount || undefined);\r\n    };\r\n    TableDataSet.prototype.getDimensionValues = function (field, query) {\r\n        return [];\r\n    };\r\n    TableDataSet.prototype.getCellData = function (_a) {\r\n        var query = _a.query;\r\n        if (this.displayData.length === 0 && query.rowIndex === 0) {\r\n            return;\r\n        }\r\n        return this.displayData[query.rowIndex][query.col];\r\n    };\r\n    TableDataSet.prototype.getMultiData = function (query, isTotals) {\r\n        return this.displayData;\r\n    };\r\n    return TableDataSet;\r\n}(BaseDataSet));\r\nexport { TableDataSet };\r\n//# sourceMappingURL=table-data-set.js.map","references":["F:/Ismart/S2-master/node_modules/@types/lodash/index.d.ts","F:/Ismart/S2-master/packages/s2-core/src/index.ts","F:/Ismart/S2-master/packages/s2-core/src/data-set/interface.ts","F:/Ismart/S2-master/packages/s2-core/src/data-set/base-data-set.ts","F:/Ismart/S2-master/packages/s2-core/src/common/interface/index.ts"],"map":"{\"version\":3,\"file\":\"table-data-set.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/data-set/table-data-set.ts\"],\"names\":[],\"mappings\":\"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\"}"}
